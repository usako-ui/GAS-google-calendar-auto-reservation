# Googleカレンダー自動日程調整システム

**日程調整の手間を、たった1つのURLで解決**

<br>
## 📌 このシステムについて

個人事業主の方が抱える「日程調整のやり取り」を自動化したWebアプリケーションです。

クライアントは送られてきたURLから希望日時を選ぶだけ。  
予約完了と同時にGoogleカレンダーへ自動登録され、双方に通知メールが届きます。

**「明日15時空いてますか?」のやり取りが不要になります。**

<br>
---
## 🎯 解決した課題

### 依頼者が抱えていた問題

複数のクライアントと日々やり取りをする個人事業主の方から、こんな声をいただきました:

- 「毎回、日程候補のすり合わせが手間」
- 「スケジュールを見比べて調整する作業が地味に大変」
- 「TimeTreeを使っているけど、自動化できないか?」

### 課題の本質は何か?

話を整理すると、求められていたのは  
❌ **特定のアプリとの連携** ではなく  
⭕ **日程調整そのものを楽にする仕組み** でした。

一般的な日程調整では:

1. クライアントから希望日を聞く
2. 自身のスケジュールを確認
3. 再度候補日を連絡
4. 場合によっては再調整

この往復が **アポ数に比例して増える** ことが問題でした。

<br

---

## 💡 解決のアプローチ

### なぜGoogleカレンダー + GASなのか?

当初検討したTimeTreeはAPI非対応で自動化が困難でした。

そこで「**誰でも使い続けられること**」を最優先に、以下の理由でGASを選択:

| 判断基準 | 理由 |
|---------|------|
| **導入ハードル** | Googleアカウントがあれば使える |
| **運用コスト** | サーバー不要、無料で運用可能 |
| **技術的障壁** | APIキー管理など複雑な設定が不要 |
| **継続性** | 設定後は日常運用がシンプル |

**「高機能」より「一般ユーザーが無理なく使い続けられる」** を重視しました。

<br>

---

## ⚙️ 主な機能

### 1. リアルタイム空き枠判定🗓

- Googleカレンダーの予定を自動取得
- **既存予定 + 前後15分バッファ** を考慮⏱
- 空いている日時のみ選択可能に 🔍

### 2. 予約の完全自動化📩

- クライアント側で日時選択 → 送信
- 双方へ自動メール通知
- Googleカレンダーへ自動登録

### 3. ダブルブッキング防止🔒

- `LockService`による排他制御
- 同時アクセスでも予約競合を防止

### 4. 直感的なUI🎨

- `flatpickr`で見やすいカレンダー表示
- 土日や予約不可日をグレーアウト表示

<br>

---
## 🧩 システム概要

### 【予約フロー】
1. ユーザーが予約フォームへアクセス  
2. flatpickr で **空いている日・時間だけ** を選択  
3. GAS が Google カレンダー予定を取得  
4. バッファ（15分）を考慮して空き枠を生成  
5. ユーザー・管理者へ自動メール通知  
6. Google カレンダーにイベント作成  

## 🖥️ 画面イメージ

### 予約フォーム画面
![予約フォームUI](予約画面1.png 
)
*クライアントが見る画面。氏名・メール・希望日時を入力*
<br>

### カレンダー選択画面
![カレンダー選択画面](予約画面2.png
)
*空いている日時のみ選択可能。土日や既存予定は自動的にグレーアウト*

<br>

---
## 🔧 技術的な工夫

### ① バッファ付き重複判定の実装

前後15分のバッファを付与し、予定が詰まりすぎないよう調整:

```javascript
// 既存予定の前後15分をバッファとして確保
const bStart = new Date(ev.start.getTime() - BUFFER_MINUTES * 60000);
const bEnd   = new Date(ev.end.getTime() + BUFFER_MINUTES * 60000);

// 重複判定
const isOverlap = slotStart < bEnd && slotEnd > bStart;
```

**→ 連続予約や移動時間を考慮した、現実的なスケジュール管理を実現**

<br>

### ② flatpickrによるUI制御

空きがない日・土日を視覚的に選択不可に:

```javascript
disable: [
  function(date) {
    const day = date.getDay();
    const formatted = date.toISOString().slice(0,10);
    
    // 土日または空き枠ゼロの日は選択不可
    return EXCLUDE_DAYS.includes(day) || !slots[formatted];
  }
]
```

**→ クライアント側で「予約できない日時」を間違えて選ぶことがない**

<br>

### ③ LockServiceによる排他制御

同時アクセス時のダブルブッキングを防止:

```javascript
const lock = LockService.getScriptLock();
lock.waitLock(30000); // 最大30秒待機

// 予約処理
// ...

lock.releaseLock();
```

**→ 複数人が同時に予約しても、確実に1件ずつ処理**

<br>
### ④📩 メール通知（自動送信）
● ユーザー向け（予約完了メール）

予約日時
入力内容の確認
任意でキャンセル案内も追加可能

● 管理者向け

新規予約通知
氏名・メールアドレス
予約日時

<br>
---

## 🚀 実際の運用状況

### 導入実績

- **知人の個人事業主に導入済み**
- スクリーンショット付き手順書を用意し、スムーズに設定完了
- 現在も日常的な日程調整に活用中

### 私自身の活用

相談・打ち合わせの日程調整に使用しており、  
**「URLを送るだけで完結する」** 点を特に便利に感じています。

<br>

---
## 📚 このプロジェクトで学んだこと

### 技術面

- **GASによるWeb APIの実装**
  - Google Calendar APIの活用
  - `doGet()`/`doPost()`によるHTTPリクエスト処理
  
- **JavaScriptでの日付・時刻計算**
  - タイムゾーン考慮
  - バッファ付き重複判定ロジック

- **フロントエンド連携**
  - flatpickrライブラリの導入
  - HTMLテンプレートとGASの連携

### 問題解決面

- **課題の本質を見極める重要性**
  - 「TimeTree連携」という手段ではなく
  - 「日程調整の手間削減」という目的に立ち返る

- **導入ハードルを下げる設計**
  - 高機能より「誰でも使える」を優先
  - 継続して使われることを前提とした設計判断

- **一般ユーザー視点でのUI/UX**
  - 説明不要で操作できる画面設計
  - エラーを起こさせない制御

<br>

---

## 🔄 今後の改善・展開案

現在検討している機能拡張:

- [ ] Google Meet URL の自動発行・通知
- [ ] 予約履歴の自動スプレッドシート保存
- [ ] クライアント側画面のデザインカスタマイズ
- [ ] 業種別の時間帯・表示項目の切り替え対応
- [ ] LINEやSlackへの通知連携

<br>

---

## 🛠 使用技術

| 項目 | 技術 |
|------|------|
| 言語 | Google Apps Script (JavaScript) |
| カレンダー連携 | Google Calendar API |
| UI | flatpickr (日付選択ライブラリ) |
| メール通知 | Gmail / MailApp |
| 排他制御 | LockService |
| デプロイ | GAS Webアプリ |

<br>

---

---

## 🛠 使用技術

| 項目 | 使用技術 |
|------|----------|
| 言語 | Google Apps Script（JavaScript） |
| UI | flatpickr |
| データ | Google Calendar API（標準GAS） |
| メール通知 | Gmail / MailApp |
| 予約排他制御 | LockService |
| デプロイ | GAS Web アプリ |

---

## 📂 プロジェクト構成

/src
├── main.gs      // 本体ロジック（API・空き枠生成・予約処理）
└── README.md    // プロジェクト説明

🧠 実装の工夫ポイント

✔ ① 既存予定＋バッファの重複判定を最適化

前後15分のバッファを付けて、予定が詰まりすぎないよう調整。

const bStart = new Date(ev.start.getTime() - BUFFER_MINUTES * 60000);
const bEnd   = new Date(ev.end.getTime() + BUFFER_MINUTES * 60000);
const isOverlap = slotStart < bEnd && slotEnd > bStart;


→ 重複予約を確実に防止

✔ ② flatpickr の disable で「空き日だけ」選択可能に
disable: [
  function(date) {
    const day = date.getDay();
    const formatted = date.toISOString().slice(0,10);
    return EXCLUDE_DAYS.includes(day) || !slots[formatted];
  }
]


→ 土日・空きがゼロの日は GUI で選択不可

✔ ③ LockService による同時アクセスの競合防止
const lock = LockService.getScriptLock();
lock.waitLock(30000);


→ 同時送信でも 二重予約を完全防止。

📩 メール通知（自動送信）
● ユーザー向け（予約完了メール）

予約日時
入力内容の確認
任意でキャンセル案内も追加可能

● 管理者向け

新規予約通知
氏名・メールアドレス
予約日時

🚀 デプロイ方法（手順）

Google Apps Script プロジェクトを作成
main.gs のコードを貼り付け
スクリプトプロパティを設定
CALENDAR_ID
START_HOUR / END_HOUR
など運用に合わせて変更可能
メニュー → デプロイ → 新しいデプロイ → Webアプリ
発行された URL を予約フォームとして公開

✨ 今後のアップデート案

Google Meet URL の自動発行
LINE 通知・Slack 通知の追加
予約履歴の自動スプレッドシート保存
キャンセル用リンクの自動発行

👩‍💻 開発者

Misako

ノーコード × GAS × Web 自動化

業務効率化ツールの開発が得意

予約管理 / 自動化システムを中心に活動

📄 ライセンス

MIT License
